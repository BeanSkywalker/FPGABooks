# 逻辑问题汇总整理

## 优先级一

### 亚稳态

关于亚稳态的知识可以参考[硬件架构的艺术第一章](./硬件架构的艺术.pdf)

以及这篇整理的关于亚稳态的文章：[亚稳态](https://note.youdao.com/ynoteshare1/index.html?id=3b6789cd37acdb0f400024c4da2be69d&type=note)

上面的文章提到的一篇经典文章：

 [跨时钟域文献:跨越鸿沟_同步世界中的异步信号(英文版)](./CrossClockDomain_design.pdf)

[跨时钟域文献:跨越鸿沟_同步世界中的异步信号(中文版)](./跨越鸿沟_同步世界中的异步信号.pdf)

**亚稳态的定义**

> 亚稳态是指由于采样时间不足，触发器无法在某个规定时间段内达到一个可确认的状态。

来自**高性能FPGA系统P18**

* 同步时序电路和异步时序电路都可能产生亚稳态
* 异步时序电路更容易产生亚稳态
* 同步时序电路也可能产生亚稳态，原因是两个组合逻辑之间延时过大，导致建立时间不满足

**进入亚稳态会有什么现象**

当一个触发器进入亚稳态时，既无法预测该单元的输出电平，也无法预测何时输出才能稳定在某个正确的电平上。在这个稳定期间，触发器输出一些中间级电平，或者可能处于振荡状态，并且这种无用的输出电平可以沿信号通道上的各个触发器级联式传播下去。

**如何减少亚稳态的发生**

[降低亚稳态的现有方法](https://note.youdao.com/ynoteshare1/index.html?id=f3c7849155698d6038a87f8b40119573&type=note)

[FPGA&数字IC开发工程师笔试116题 第6题，第55题](./FPGA&数字IC开发工程师笔试116题.pdf)

* 打两拍

也就是同步的方式，引入同步机制，防止亚稳态的传播

* 降低系统时钟频率
* 用反应更快的触发器
* 改善时钟质量，用边沿变化快速的时钟信号

**亚稳态的危害**

* 如果不能在一个周期内返回到亚稳态，那么目的寄存器也会发生亚稳态
* 亚稳态的毛刺直接输出，可能导致系统错误（CPU中断错误响应）
* 采样到错误的电平，导致系统功能错误（独热码出现非法状态）

### 复位

可以参考[硬件架构的艺术第二章](./硬件架构的艺术.pdf)

**同步复位和异步复位的区别**

* 同步复位在时钟沿变化时，完成复位动作

* 异步复位不管时钟，只要复位信号满足条件，就完成复位动作

* 异步复位对复位信号要求比较高，不能有毛刺，如果其与时钟关系不确定，也可能出现亚稳态

  注：要知道同步复位和异步复位的RTL电路图怎么画

**同步复位**

优点：

* 抗干扰强，可剔除复位信号中的毛刺
* 有利于静态时序分析工具进行分析
* 有利于仿真

缺点

* 占用更多的逻辑资源
* 复位信号宽度必须大于一个时钟周期，且很难保证复位信号到达各个寄存器的时序
* 复位信号依赖于时钟，如果时钟出现问题，则无法复位

**异步复位**

优点：

* 无需额外的逻辑资源，实现简单，可以保证复位引脚到各个寄存器的时钟偏斜最小
* 复位信号不依赖于时钟

缺点：

* 复位信号容易受外界干扰，且对电路内的毛刺敏感
* 复位信号释放的随机性，可能导致亚稳态

[同步复位和异步复位的优缺点对比](https://note.youdao.com/ynoteshare1/index.html?id=c822e72ad1882fd6dfe9009e25b5318e&type=note)

**移除异步复位的问题**

> 如果你想让某个时钟沿起作用，那么你就应该在“恢复时间”之前使异步控制信号变无效，如果你想让某个时钟沿不起作用，那么你就应该在“去除时间”过后使控制信号变无效。如果你的控制信号在这两种情况之间，那么就没法确定时钟沿是否起作用或不起作用了，也就是说可能会造成寄存器处于不确定的状态。而这些情况是应该避免的。所以恢复时间和去除时间是应该遵守的。

来自**高性能FPGA系统P11**

* 恢复时间

  复位信号无效到时钟翻转的时间，也就是复位信号撤除，到时钟上升沿之间的时间。

  是指异步控制信号（如寄存器的异步清除和置位控制信号）在“下个时钟沿”来临之前变无效的最小时间长度。这个时间的意义是，如果保证不了这个最小恢复时间，也就是说这个异步控制信号的解除与“下个时钟沿”离得太近（但在这个时钟沿之前），没有给寄存器留有足够时间来恢复至正常状态，那么就不能保证“下个时钟沿”能正常作用，也就是说这个“时钟沿”可能会失效。

* 去除时间

  时钟边沿之后复位信号任然保持有效的时间。

  去除时间（Removal）是指异步控制信号（如寄存器的异步清除和置位控制信号）在“有效时钟沿”之后变无效的最小时间长度。这个时间的意义是，如果保证不了这个去除时间，也就是说这个异步控制信号的解除与“有效时钟沿”离得太近（但在这个时钟沿之后），那么就不能保证有效地屏蔽这个“时钟沿”，也就是说这个“时钟沿”可能会起作用。

### 跨时钟域处理办法

[FPGA开发者联盟资料](https://note.youdao.com/ynoteshare1/index.html?id=6105a1b98454c1610d16e6b5cdbf960d&type=note)

下面这个PPT总结了跨时钟常用处理方法：

[CDC--讲师卢子威](./CDC--讲师卢子威.pptx)

以及根据PPT总结的文档：

[CDC总结](./CDC总结.md)

不同的时钟域之间信号通信时需要进行同步处理，这样可以防止新时钟域中第一级触发器的亚稳态信号对下级逻辑造成影响。

[跨时钟域处理方法](https://note.youdao.com/ynoteshare1/index.html?id=d2d8c11ef9bbfeff8948d6649a4bfecb&type=note)

* 单bit

  打两拍，也就是采用两级触发器来同步

  也叫电平同步器，相关[同步器资料](https://note.youdao.com/ynoteshare1/index.html?id=f86c02e32fd0d1588805e74bd1850ea7&type=note)

  * 低频向高频
  * 高频向低频（需要展宽电路）

* 多bit

  * 格雷码转换
  * 异步FIFO
  * 采用握手信号

### 时序分析

[时序约束整理](./时序约束整理.md)

[八小时超长视频教你掌握FPGA时序约束](https://mp.weixin.qq.com/s/V3qCQNCcxpO_PaWso3GWkw)

它可以简单的定义为：设计者提出一些特定的时序要求（或者说是添加特定的时序约束），套用特定的时序模型，针对特定的电路进行分析。分析的最终结果当然是要求系统时序满足设计者提出的要求。

因此，有些说法是错误的，不分什么情况就说时序不收敛，其实在不加约束的情况下谈时序约束是没有意义的。

* 静态时序分析

  静态时序分析是采用穷尽分析方法来提取出整个电路存在的所有时序路径，计算信号在这些路径上的传播延时，检查信号的建立和保持时间是否满足时序要求，通过对最大路径延时和最小路径延时的分析，找出违背时序约束的错误。它不需要输入向量就能穷尽所有的路径，且运行速度很快、占用内存较少，不仅可以对芯片设计进行全面的时序功能检查，而且还可利用时序分析的结果来优化设计，因此静态时序分析已经越来越多地被用到数字集成电路设计的验证中。

* 动态时序分析

  动态时序模拟就是通常的仿真，因为不可能产生完备的测试向量，覆盖门级网表中的每一条路径。因此在动态时序分析中，无法暴露一些路径上可能存在的时序问题。

时序设计的实质

> 时序设计的实质就是满足每一个触发器的建立/保持时间的要求。

**时序约束**

[听说你会时序约束，你是怎么进行约束的](https://note.youdao.com/ynoteshare1/index.html?id=93ab93532026e6e072525c7124767c2b&type=note)

通过附加时序约束可以综合布线工具调整映射和布局布线，使设计达到时序要求。

时序约束是指在逻辑综合、布局布线或者静态时序分析时，在综合工具、布局布线（P&R）工具或静态时序分析（ STA）工具中指定信号的频率/周期、占空比、时延等约束条件， EDA 工具根据设定的约束条件来工作。

时序约束主要包括：

* 周期约束

* 偏移约束

* 静态时序路径

  静态时序路径就是：那些时序路径的约束

一般来说，添加约束的原则为先附加全局约束，再补充局部约束，而且局部约束比较宽松。其目的是在可能的地方尽量放松约束，提高布线成功概率，减少ISE布局布线时间。

典型的全局约束包括周期约束和偏移约束。需要根据时钟频率划分不同的时钟域，添加各自的周期约束；然后对输入输出端口信号添加偏移约束。

* 全局约束

  * 周期约束

    周期约束是附加在时钟网络上的基本时序约束，以保证时钟区域内所有同步组件的时序满足要求

  * 偏移约束

    偏移约束是一类基本时序约束，规定了外部时钟和数据输入输出引脚之间的相对时序关系，只能用于端口信号，不能用于内部信号，包括`OFFSET_IN_BEFORE`, `OFFSET_IN_AFTER`, `OFFSET_OUT_BEFORE`, `OFFSET_OUT_AFTER`等4类基本约束

  * 分组约束

    分组约束可有效管理大量的触发器、寄存器和存储器单元。将其分为不同的组，每组附加各自的约束，在大型设计中有着广泛的应用。

    `TNM/TNM_NET`约束用于选出可构成一个分组的元件，并对其重新命名，然后整体添加约束。除了`IBUFG`和`BUFG`外，所有的FPGA内部元件都可以用`TNM`来命名。

    `TIMEGRP`用于分组合并和拆分，将多个分组形成一个新的分组。

* 局部约束

  局部约束包括`FROM_TO`约束、最大延时约束、最大偏移约束、虚假约束、系统时钟抖动约束、多周期路径和多时钟域约束等。在实际开发中，时序是设计出来的，而不是靠约束自动得到的。

时序路径：

* 从输入端口到触发器的数据D端 PAD_TO_SETUP
* 从触发器的时钟CLK端到触发器的数据D端 CLOCK_TO_SETUP
* 从触发器的时钟CLK端到输出端口 CLOCK_TO_PAD
* 从输入端口到输出端口 PAD_TO_PAD

基本策略

时序约束的一般策略是先附加全局约束，然后对快速和慢速例外路径附加专门约束。附加全局约束时，首先定义设计的所有时钟，对各时钟域内的同步元件进行分组，对分组附加周期约束、对全组合逻辑的PAD_TO_PAD路径附加约束。附加专门约束时，首先约束分组之间的路径，然后约束块、慢速例外路径和多周期路径，以及其他特殊路径。

[听说你会时序分析，你都是怎么进行分析的](https://note.youdao.com/ynoteshare1/index.html?id=822c154261706675078041cbf8fa1180&type=note)

### FPGA设计流程

### FPGA的组成、内部资源

### FPGA和ASIC的区别

### 可编程片上系统SOPC

### 时钟资源

### 三大通讯协议

### 接口协议

### 竞争冒险

### 阻塞和非阻塞的理解

阻塞(=)和非阻塞(<=)语句的最主要的区别**在其后的引用它的语句的电路结构上**：

* 对于阻塞语句，其综合出的**组合逻辑**的输出，被馈送到其后引用它的语句的组合逻辑的输入端，也即后面的语句引用其新值；
* 对于非阻塞语句，其综合出的**触发器**的输出，被馈送到其后引用它的语句的组合逻辑的输入端，也即后面的语句引用其旧值。

以上内容来自[数字IC面试题](./数字IC面试题.pdf)

详细内容可以参考Clifford E. Cummings的两篇论文:

[Nonblocking Assignments in Verilog Synthesis, Coding Styles That Kill](./Nonblocking%20Assignments%20in%20Verilog%20Synthesis,%20Coding%20Styles%20That%20Kill.pdf)

[Verilog Nonblocking Assignments With Delays,Myths & Mysteries](./Verilog%20Nonblocking%20Assignments%20With%20Delays,Myths%20&%20Mysteries.pdf)

### 时序逻辑和组合逻辑的区别

### 状态机的逻辑实现

### DSP架构

### 同步设计

### ZYNQ

### 同步通讯和异步通讯

### 源同步和系统同步之间的区别

### 各种存储器之间的对比

### 锁相环

### 奇数分频

### 同步FIFO, 异步FIFO

### 序列检测

### 利用与非门设计异或门

### JOHNSON计数器

### 串并转换

## 优先级二

### 冯诺依曼、哈佛架构

### 反向们、与非门、或非门的mos管实现

### 磁珠在电路中的作用

### 按键消抖verilog实现

### 串扰

### 大小端模式

### TTL与CMOS

### CRC校验

### 伪随机序列

## 乘法器的原理

[乘法器的原理](https://note.youdao.com/ynoteshare1/index.html?id=21a32bc5552244d7091ba2b4d84d8129&type=note)

[乘法器相关包括Booth乘法器](./Verilog_HDL_那些事儿_时序篇v2.pdf)

## 一些行业的好文章

[项目经历很不错，应届身份进大厂你的学历和学校吃亏](https://note.youdao.com/ynoteshare1/index.html?id=1b2da1cd2057f4f4f598a7ab138433fd&type=note)

[FPGA工程师的个人工作经历总结](https://note.youdao.com/ynoteshare1/index.html?id=b1d7422af68945e048528136f3d0a30a&type=note)

[很多人觉得FPGA难学，因为他们没总结出数电的尽头是模电](https://note.youdao.com/ynoteshare1/index.html?id=52e6bd52814f2894689e922847ffe315&type=note)

[大疆面经](https://note.youdao.com/ynoteshare1/index.html?id=85e2a7ba6cdb1d9b3e11150935ead829&type=note)

[NI面经](https://note.youdao.com/ynoteshare1/index.html?id=dc444e0824abc82842c43ff8222fdb71&type=note)